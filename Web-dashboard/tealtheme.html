<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart AquaSense Dashboard</title>

  <!-- Tailwind + DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#0d9488",  // teal-600
            secondary: "#14b8a6",// teal-500
            accent: "#99f6e4",   // teal-100
            success: "#10b981",  // green-500
            danger: "#dc2626",   // red-600
            neutral: "#0f172a",  // slate-900
          },
        },
      },
      plugins: [daisyui],
      daisyui: {
        themes: [
          {
            aquateal: {
              primary: "#0d9488",
              secondary: "#14b8a6",
              accent: "#99f6e4",
              neutral: "#0f172a",
              "base-100": "#f0fdfa",
              info: "#67e8f9",
              success: "#10b981",
              warning: "#fbbf24",
              error: "#ef4444",
            },
          },
        ],
      },
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/daisyui@4.6.0/dist/full.min.js"></script>

  <!-- ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #ccfbf1, #f0fdfa);
    }
  </style>
</head>
<body data-theme="aquateal" class="min-h-screen flex flex-col">

  <div class="container mx-auto px-4 py-6 flex-grow">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-primary mb-1">ðŸ’§ Smart AquaSense</h1>
      <p class="text-gray-600">Real-time Water Quality Monitoring</p>
      <p id="status-bar" class="text-sm text-gray-500 mt-2">Fetching data...</p>
    </div>

    <!-- Metric Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="card bg-base-100 shadow-lg border-t-4 border-primary p-4 text-center">
        <h2 class="text-sm text-gray-500">pH Level</h2>
        <div id="ph-value" class="text-3xl font-semibold my-2 text-primary">--</div>
        <div id="ph-status" class="text-sm font-bold text-gray-600">--</div>
      </div>

      <div class="card bg-base-100 shadow-lg border-t-4 border-secondary p-4 text-center">
        <h2 class="text-sm text-gray-500">Temperature</h2>
        <div id="temp-value" class="text-3xl font-semibold my-2 text-secondary">--</div>
        <div id="temp-status" class="text-sm font-bold text-gray-600">--</div>
      </div>

      <div class="card bg-base-100 shadow-lg border-t-4 border-accent p-4 text-center">
        <h2 class="text-sm text-gray-500">Turbidity</h2>
        <div id="turb-value" class="text-3xl font-semibold my-2 text-accent">--</div>
        <div id="turb-status" class="text-sm font-bold text-gray-600">--</div>
      </div>

      <div class="card bg-base-100 shadow-lg border-t-4 border-primary p-4 text-center">
        <h2 class="text-sm text-gray-500 mb-1">System Status</h2>
        <div id="system-status" class="text-lg font-bold mb-2 text-gray-600">--</div>
        <small id="last-updated" class="text-xs text-gray-500">Last updated: --</small>
      </div>
    </div>

    <!-- Chart -->
    <div class="card bg-base-100 shadow-xl p-6">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Recent Water Quality Trends (Last 10 Readings)</h3>
      <div id="trendChart"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-primary text-white text-center py-3 text-sm">
    &copy; 2025 Designed & Developed by Praise R. Ziome
  </footer>

  <script>
    const maxPoints = 10;
    let labels = [], phData = [], tempData = [], turbData = [];

    const chartOptions = {
      chart: {
        type: 'line',
        height: 300,
        toolbar: { show: false },
      },
      stroke: { curve: 'smooth', width: 3 },
      grid: { borderColor: '#e2e8f0' },
      colors: ['#0d9488', '#14b8a6', '#99f6e4'],
      series: [
        { name: 'pH', data: [] },
        { name: 'Temperature (Â°C)', data: [] },
        { name: 'Turbidity (NTU)', data: [] },
      ],
      xaxis: { categories: [], labels: { style: { colors: '#475569' } } },
      yaxis: { labels: { style: { colors: '#475569' } }, min: 0 },
      legend: { position: 'bottom', labels: { colors: '#0f172a' } },
      tooltip: { theme: 'light' }
    };

    const chart = new ApexCharts(document.querySelector("#trendChart"), chartOptions);
    chart.render();

    function updateChart(ph, temp, turb, timeLabel) {
      labels.push(timeLabel);
      phData.push(ph);
      tempData.push(temp);
      turbData.push(turb);
      if (labels.length > maxPoints) {
        labels.shift(); phData.shift(); tempData.shift(); turbData.shift();
      }
      chart.updateOptions({
        xaxis: { categories: labels },
        series: [
          { name: 'pH', data: phData },
          { name: 'Temperature (Â°C)', data: tempData },
          { name: 'Turbidity (NTU)', data: turbData },
        ]
      });
    }

    function updatePH(value) {
      document.getElementById("ph-value").innerText = value.toFixed(2);
      const status = document.getElementById("ph-status");
      if (value >= 6.5 && value <= 8.5) {
        status.innerText = "Safe"; status.className = "text-success font-bold";
      } else {
        status.innerText = "Unsafe"; status.className = "text-danger font-bold";
      }
    }

    function updateTemp(value) {
      document.getElementById("temp-value").innerText = value.toFixed(1) + "Â°C";
      const status = document.getElementById("temp-status");
      if (value >= 20 && value <= 30) {
        status.innerText = "Safe"; status.className = "text-success font-bold";
      } else {
        status.innerText = "Unsafe"; status.className = "text-danger font-bold";
      }
    }

    function updateTurb(value) {
      document.getElementById("turb-value").innerText = value.toFixed(1) + " NTU";
      const status = document.getElementById("turb-status");
      if (value <= 5) {
        status.innerText = "Safe"; status.className = "text-success font-bold";
      } else {
        status.innerText = "Unsafe"; status.className = "text-danger font-bold";
      }
    }

    function updateSystemStatus(ph, temp, turb) {
      const system = document.getElementById("system-status");
      const lastUpdated = document.getElementById("last-updated");
      if ((ph >= 6.5 && ph <= 8.5) && (temp >= 20 && temp <= 30) && (turb <= 5)) {
        system.innerText = "All Systems OK";
        system.className = "text-success font-bold";
      } else {
        system.innerText = "Attention Needed";
        system.className = "text-danger font-bold";
      }
      lastUpdated.innerText = "Last updated: " + new Date().toLocaleTimeString();
    }

    async function fetchSensorData() {
      try {
        const res = await fetch("fetch_data.php");
        const data = await res.json();
        if (!data.length) {
          document.getElementById("status-bar").innerText = "No data available";
          return;
        }
        const latest = data[0];
        updatePH(parseFloat(latest.ph));
        updateTemp(parseFloat(latest.temperature));
        updateTurb(parseFloat(latest.turbidity));
        updateSystemStatus(latest.ph, latest.temperature, latest.turbidity);
        updateChart(latest.ph, latest.temperature, latest.turbidity, latest.timestamp);
        document.getElementById("status-bar").innerText = "Connected to Database âœ“";
      } catch (error) {
        document.getElementById("status-bar").innerText = "Error fetching data";
      }
    }

    setInterval(fetchSensorData, 10000);
    fetchSensorData();
  </script>

</body>
</html>